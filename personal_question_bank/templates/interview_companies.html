{% extends "base.html" %}

{% block title %}我的题库 - 个人题库系统{% endblock %}

{% block extra_head %}
<style>
/* 全局样式优化 */
body {
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    min-height: 100vh;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

.container-fluid {
    background: transparent;
}

/* 页面标题美化 */
.page-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 2rem 0;
    margin-bottom: 2rem;
    border-radius: 0 0 30px 30px;
    box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
}

.page-header h1 {
    font-weight: 700;
    font-size: 2.5rem;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    margin-bottom: 0.5rem;
}

.page-header p {
    font-size: 1.1rem;
    opacity: 0.9;
    margin-bottom: 0;
}

/* 公司卡片样式升级 */
.company-card {
    border: none;
    border-radius: 25px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.08), 
                0 4px 8px rgba(102, 126, 234, 0.05);
    transition: all 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
    overflow: hidden;
    position: relative;
    background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.4);
    transform-origin: center;
    transform: perspective(1000px) rotateX(0deg);
}

.company-card:hover {
    transform: perspective(1000px) rotateX(5deg) translateY(-10px) scale(1.02);
    box-shadow: 0 20px 60px rgba(0,0,0,0.12), 
                0 8px 24px rgba(102, 126, 234, 0.15),
                0 4px 12px rgba(128, 90, 213, 0.1);
}

.company-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 5px;
    background: linear-gradient(90deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
    opacity: 0;
    transition: all 0.3s ease;
}

.company-card:hover::before {
    opacity: 1;
    height: 8px;
}

.company-card::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
}

.company-card:hover::after {
    opacity: 1;
}

/* 公司头部样式升级 */
.company-header {
    height: 160px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    color: white;
    font-weight: 700;
    font-size: 1.4rem;
    text-shadow: 0 3px 6px rgba(0,0,0,0.4);
    background-size: cover;
    background-position: center;
    overflow: hidden;
}

.company-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0.1) 100%);
    z-index: 1;
}

.company-header h4 {
    position: relative;
    z-index: 2;
    margin: 0;
    font-size: 1.5rem;
    letter-spacing: 1px;
    text-transform: uppercase;
}

.company-header::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 40px;
    background: linear-gradient(to top, rgba(0,0,0,0.2), transparent);
    z-index: 1;
}

/* 公司特定背景渐变 */
.company-alibaba {
    background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
}

.company-tencent {
    background: linear-gradient(135deg, #00d4ff 0%, #090979 100%);
}

.company-bytedance {
    background: linear-gradient(135deg, #000000 0%, #434343 100%);
}

.company-baidu {
    background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
}

.company-meituan {
    background: linear-gradient(135deg, #ffb300 0%, #ff8f00 100%);
}

.company-jd {
    background: linear-gradient(135deg, #e53935 0%, #c62828 100%);
}

.company-netease {
    background: linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%);
}

/* 动态添加的公司样式 */
.company-header:not([class*="company-"]) {
    background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
}

/* 为新添加的公司提供随机颜色 */
.company-default {
    background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
}

.company-startup {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
}

.company-unicorn {
    background: linear-gradient(135deg, #6f42c1 0%, #e83e8c 100%);
}

.company-foreign {
    background: linear-gradient(135deg, #fd7e14 0%, #dc3545 100%);
}

.company-traditional {
    background: linear-gradient(135deg, #17a2b8 0%, #007bff 100%);
}



.difficulty-chart {
    height: 8px;
    background: #f8f9fa;
    border-radius: 4px;
    overflow: hidden;
    position: relative;
}

.difficulty-bar {
    height: 100%;
    float: left;
}

.difficulty-easy { background: #28a745; }
.difficulty-medium { background: #ffc107; }
.difficulty-hard { background: #dc3545; }

/* 统计数据样式升级 */
.company-stats {
    display: flex;
    justify-content: space-around;
    margin: 20px 0;
    padding: 20px 15px;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(248, 249, 250, 0.8) 100%);
    border-radius: 20px;
    border: 1px solid rgba(102, 126, 234, 0.2);
    backdrop-filter: blur(10px);
    box-shadow: 
        0 4px 15px rgba(102, 126, 234, 0.05),
        inset 0 0 20px rgba(102, 126, 234, 0.05);
    position: relative;
    overflow: hidden;
}

.company-stats::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(102, 126, 234, 0.08) 0%, transparent 50%);
    animation: rotateGradient 8s linear infinite;
}

@keyframes rotateGradient {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.stat-item {
    text-align: center;
    position: relative;
    padding: 15px 10px;
    transition: all 0.4s ease;
    border-radius: 15px;
    flex: 1;
    background: linear-gradient(135deg, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0.4) 100%);
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.05);
    border: 1px solid rgba(255,255,255,0.6);
    backdrop-filter: blur(5px);
}

.stat-item:hover {
    transform: translateY(-5px);
    background: linear-gradient(135deg, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0.4) 100%);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2);
}

.stat-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 40px;
    height: 4px;
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    border-radius: 2px;
    opacity: 0;
    transition: all 0.3s ease;
}

.stat-item:hover::before {
    opacity: 1;
    width: 60px;
}

.stat-number {
    font-size: 2rem;
    font-weight: 900;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 8px;
    text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    display: block;
    line-height: 1.2;
}

.stat-label {
    font-size: 0.9rem;
    color: #6c757d;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-top: 5px;
}

/* 标签和描述样式美化 */
.question-type-badges {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    margin: 15px 0;
}

.type-badge {
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 0.8rem;
    color: white;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1),
                0 2px 6px rgba(102, 126, 234, 0.2);
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.9) 0%, rgba(118, 75, 162, 0.9) 100%);
    backdrop-filter: blur(5px);
    border: 1px solid rgba(255,255,255,0.2);
}

.type-badge:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
}

.type-theory { background: #6f42c1; }
.type-coding { background: #28a745; }
.type-practical { background: #fd7e14; }

/* 页面标题区域美化 */
.interview-tips {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 25px;
    padding: 40px 30px;
    margin-bottom: 40px;
    color: white;
    box-shadow: 0 15px 50px rgba(102, 126, 234, 0.3);
    position: relative;
    overflow: hidden;
}

.interview-tips::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
    animation: float 6s ease-in-out infinite;
}

@keyframes float {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-20px) rotate(180deg); }
}

.interview-tips h2 {
    font-weight: 800;
    font-size: 2.2rem;
    margin-bottom: 15px;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

.interview-tips p {
    font-size: 1.1rem;
    opacity: 0.95;
    line-height: 1.6;
}

.interview-tips .btn {
    background: rgba(255,255,255,0.2);
    border: 2px solid rgba(255,255,255,0.3);
    color: white;
    border-radius: 25px;
    padding: 12px 24px;
    font-weight: 600;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
}

.interview-tips .btn:hover {
    background: rgba(255,255,255,0.3);
    border-color: rgba(255,255,255,0.5);
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.2);
}

/* 筛选器样式升级 */
.filter-section {
    background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
    border-radius: 25px;
    padding: 30px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    margin-bottom: 40px;
    border: 1px solid rgba(255,255,255,0.3);
    backdrop-filter: blur(20px);
    position: relative;
    overflow: hidden;
}

.filter-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
}

.filter-section h5 {
    color: #495057;
    font-weight: 700;
    margin-bottom: 25px;
    font-size: 1.3rem;
}

.form-label {
    font-weight: 600;
    color: #495057;
    margin-bottom: 8px;
    font-size: 0.95rem;
}

.form-select {
    border: 2px solid rgba(102, 126, 234, 0.2);
    border-radius: 15px;
    padding: 12px 16px;
    font-size: 0.95rem;
    transition: all 0.3s ease;
    background: white;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}

.form-select:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
    transform: translateY(-2px);
}

.form-select:hover {
    border-color: #667eea;
    transform: translateY(-1px);
}

/* 按钮样式升级 */
.practice-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    border-radius: 30px;
    padding: 12px 24px;
    font-weight: 700;
    font-size: 0.95rem;
    transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
    position: relative;
    overflow: hidden;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

.practice-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    transition: left 0.5s ease;
}

.practice-btn:hover::before {
    left: 100%;
}

.practice-btn:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 12px 35px rgba(102, 126, 234, 0.5);
}

.practice-btn:active {
    transform: translateY(-1px) scale(1.02);
}

.practice-btn.loading {
    pointer-events: none;
    opacity: 0.8;
}

.practice-btn.loading::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 20px;
    height: 20px;
    margin: -10px 0 0 -10px;
    border: 2px solid transparent;
    border-top: 2px solid white;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.detail-btn {
    border: 2px solid #667eea;
    color: #667eea;
    border-radius: 30px;
    padding: 12px 24px;
    font-weight: 700;
    font-size: 0.95rem;
    transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
    background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.7) 100%);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    position: relative;
    overflow: hidden;
}

.detail-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.detail-btn:hover::before {
    opacity: 1;
}

.detail-btn:hover {
    color: white;
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
    border-color: transparent;
}

.detail-btn span {
    position: relative;
    z-index: 1;
}

/* 额外的美化效果 */
.company-card .card-body {
    position: relative;
}

.company-card .card-body::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(circle at 50% 50%, rgba(102, 126, 234, 0.03) 0%, transparent 70%);
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
}

.company-card:hover .card-body::before {
    opacity: 1;
}

/* 难度条美化 */
.difficulty-chart {
    height: 10px;
    background: rgba(0,0,0,0.1);
    border-radius: 10px;
    overflow: hidden;
    position: relative;
    margin: 15px 0;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
}

.difficulty-bar {
    height: 100%;
    float: left;
    transition: all 0.3s ease;
}

.difficulty-easy {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
}

.difficulty-medium {
    background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
}

.difficulty-hard {
    background: linear-gradient(135deg, #dc3545 0%, #e83e8c 100%);
}

/* 响应式优化 */
@media (max-width: 768px) {
    .company-card {
        margin-bottom: 20px;
    }

    .company-header h4 {
        font-size: 1.2rem;
    }

    .stat-number {
        font-size: 1.5rem;
    }

    .interview-tips {
        padding: 25px 20px;
    }

    .interview-tips h2 {
        font-size: 1.8rem;
    }

    .filter-section {
        padding: 20px;
    }
}

/* 滚动条美化 */
::-webkit-scrollbar {
    width: 8px;
}

::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
}

::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 10px;
}

::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- 页面标题 -->
    <div class="interview-tips">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h2><i class="fas fa-database me-2"></i>我的题库</h2>
                <p class="mb-0">管理和练习你收藏的公司面试题目，建立个人专属题库</p>
            </div>
            <div class="col-md-4 text-end">
                <button class="btn btn-outline-primary" onclick="showAddCompanyModal()">
                    <i class="fas fa-plus me-1"></i>添加公司
                </button>
            </div>
        </div>
    </div>

    <!-- 筛选器 -->
    <div class="filter-section">
        <div class="row">
            <div class="col-md-4">
                <label class="form-label">公司类型</label>
                <select class="form-select" id="companyTypeFilter">
                    <option value="">全部类型</option>
                    <option value="big_tech">大厂 (BAT等)</option>
                    <option value="unicorn">独角兽</option>
                    <option value="startup">创业公司</option>
                </select>
            </div>
            <div class="col-md-4">
                <label class="form-label">岗位方向</label>
                <select class="form-select" id="positionFilter">
                    <option value="">全部岗位</option>
                    <option value="frontend">前端开发</option>
                    <option value="backend">后端开发</option>
                    <option value="fullstack">全栈开发</option>
                    <option value="algorithm">算法工程师</option>
                </select>
            </div>
            <div class="col-md-4">
                <label class="form-label">面试年份</label>
                <select class="form-select" id="yearFilter">
                    <option value="">全部年份</option>
                    <option value="2024">2024年</option>
                    <option value="2023">2023年</option>
                    <option value="2022">2022年</option>
                </select>
            </div>
        </div>
    </div>

    <!-- 公司卡片 -->
    <div class="row" id="companiesList">
        <!-- 公司卡片将通过JavaScript动态加载 -->
        <div class="col-12">
            <div class="text-center py-5">
                <i class="fas fa-spinner fa-spin fa-3x text-primary mb-3"></i>
                <h5 class="text-muted">正在加载公司数据...</h5>
            </div>
        </div>

    </div>

    <!-- 统计信息 -->
    <div class="card mt-4">
        <div class="card-header">
            <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i>面试趋势分析</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <canvas id="difficultyTrendChart" width="400" height="200"></canvas>
                </div>
                <div class="col-md-6">
                    <canvas id="topicDistributionChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 添加公司模态框 -->
<div class="modal fade" id="addCompanyModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <h5 class="modal-title">
                    <i class="fas fa-plus me-2"></i>添加新公司
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addCompanyForm">
                    <div class="mb-3">
                        <label class="form-label">公司名称 <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="companyName" required placeholder="请输入公司名称">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">公司类型</label>
                        <select class="form-select" id="companyType">
                            <option value="big_tech">大厂 (BAT等)</option>
                            <option value="unicorn">独角兽</option>
                            <option value="startup">创业公司</option>
                            <option value="foreign">外企</option>
                            <option value="traditional">传统企业</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">主要技术栈</label>
                        <div class="row">
                            <div class="col-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="Vue" id="tech-vue">
                                    <label class="form-check-label" for="tech-vue">Vue.js</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="React" id="tech-react">
                                    <label class="form-check-label" for="tech-react">React</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="JavaScript" id="tech-js">
                                    <label class="form-check-label" for="tech-js">JavaScript</label>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="Golang" id="tech-go">
                                    <label class="form-check-label" for="tech-go">Golang</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="Python" id="tech-python">
                                    <label class="form-check-label" for="tech-python">Python</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="Java" id="tech-java">
                                    <label class="form-check-label" for="tech-java">Java</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">面试难度</label>
                        <select class="form-select" id="companyDifficulty">
                            <option value="3.0">简单 (3.0)</option>
                            <option value="3.5">较简单 (3.5)</option>
                            <option value="4.0" selected>中等 (4.0)</option>
                            <option value="4.5">较难 (4.5)</option>
                            <option value="5.0">困难 (5.0)</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">公司描述</label>
                        <textarea class="form-control" id="companyDescription" rows="3" placeholder="简单描述公司特点和面试重点..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="addNewCompany()">
                    <i class="fas fa-save me-1"></i>保存公司
                </button>
            </div>
        </div>
    </div>
</div>

<!-- 公司详情模态框 -->
<div class="modal fade" id="companyDetailModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="companyModalTitle">公司详情</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="companyModalContent">
                <!-- 动态加载公司详情 -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary" id="startCompanyPracticeBtn">
                    <i class="fas fa-play me-1"></i>开始练习
                </button>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    initCharts();
    updateQuestionCounts();
    setupFilters();
    loadCompaniesFromDatabase();

    // 页面加载动画
    animatePageLoad();

    // 更新实时数据
    setTimeout(updateCompanyStats, 1000);
});

// 从数据库加载公司数据
function loadCompaniesFromDatabase() {
    console.log('从数据库加载公司数据...');

    fetch('/api/companies')
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(companies => {
            console.log('获取到公司数据:', companies);

            if (Array.isArray(companies) && companies.length > 0) {
                // 清空现有的公司列表
                const companiesList = document.getElementById('companiesList');
                companiesList.innerHTML = '';

                // 动态渲染所有公司卡片
                companies.forEach(company => {
                    // 确保公司数据有必要的字段
                    const companyData = {
                        id: company.id,
                        name: company.name,
                        questionCount: company.question_count || 0,
                        difficulty: company.difficulty || '4.0',
                        passRate: company.pass_rate || '70',
                        techStack: company.tech_stack ? (Array.isArray(company.tech_stack) ? company.tech_stack : JSON.parse(company.tech_stack || '[]')) : [],
                        description: company.description || '暂无描述',
                        isDefault: company.is_default || false
                    };

                    const companyCard = createCompanyCard(companyData);
                    companiesList.insertAdjacentHTML('beforeend', companyCard);
                });

                console.log(`成功渲染了 ${companies.length} 个公司卡片`);
            } else {
                console.warn('没有获取到公司数据');
                // 如果没有数据，显示提示信息
                const companiesList = document.getElementById('companiesList');
                companiesList.innerHTML = `
                    <div class="col-12">
                        <div class="text-center py-5">
                            <i class="fas fa-building fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted">暂无公司数据</h5>
                            <p class="text-muted">请添加公司来开始使用</p>
                        </div>
                    </div>
                `;
            }
        })
        .catch(error => {
            console.error('加载公司数据失败:', error);
            // 显示错误信息
            const companiesList = document.getElementById('companiesList');
            companiesList.innerHTML = `
                <div class="col-12">
                    <div class="text-center py-5">
                        <i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i>
                        <h5 class="text-warning">加载失败</h5>
                        <p class="text-muted">无法加载公司数据，请刷新页面重试</p>
                        <button class="btn btn-primary" onclick="loadCompaniesFromDatabase()">重新加载</button>
                    </div>
                </div>
            `;
        });
}

// 更新公司删除按钮状态
function updateCompanyDeleteButtons(companies) {
    companies.forEach(company => {
        // 根据公司ID找到对应的删除按钮并更新状态
        const deleteButtons = document.querySelectorAll(`[onclick*="deleteCompany(${company.id}"]`);
        deleteButtons.forEach(button => {
            if (company.isDefault) {
                button.disabled = true;
                button.title = '系统默认公司不能删除';
                button.classList.add('disabled');
            } else {
                button.disabled = false;
                button.title = '删除公司';
                button.classList.remove('disabled');
            }
        });
    });
}

function animatePageLoad() {
    // 为公司卡片添加入场动画
    document.querySelectorAll('.company-card').forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(50px)';

        setTimeout(() => {
            card.style.transition = 'all 0.6s cubic-bezier(0.25, 0.8, 0.25, 1)';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 150);
    });

    // 筛选器动画
    const filterSection = document.querySelector('.filter-section');
    if (filterSection) {
        filterSection.style.opacity = '0';
        filterSection.style.transform = 'translateY(-30px)';

        setTimeout(() => {
            filterSection.style.transition = 'all 0.5s ease';
            filterSection.style.opacity = '1';
            filterSection.style.transform = 'translateY(0)';
        }, 200);
    }
}

function updateCompanyStats() {
    // 模拟从API获取最新数据并添加动画效果
    const companies = ['alibaba', 'tencent', 'bytedance', 'baidu', 'meituan', 'jd'];

    companies.forEach((company, index) => {
        setTimeout(() => {
            const element = document.getElementById(`${company}-questions`);
            if (element) {
                const currentValue = parseInt(element.textContent) || 0;
                const newValue = Math.floor(Math.random() * 20) + 10;
                animateNumber(element, currentValue, newValue);
            }
        }, index * 200);
    });
}

function animateNumber(element, start, end) {
    const duration = 1000;
    const startTime = performance.now();

    function update(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);

        const current = Math.floor(start + (end - start) * easeOutCubic(progress));
        element.textContent = current;

        if (progress < 1) {
            requestAnimationFrame(update);
        }
    }

    requestAnimationFrame(update);
}

function easeOutCubic(t) {
    return 1 - Math.pow(1 - t, 3);
}

function showToast(message, type = 'info') {
    // 创建toast容器（如果不存在）
    let toastContainer = document.getElementById('toast-container');
    if (!toastContainer) {
        toastContainer = document.createElement('div');
        toastContainer.id = 'toast-container';
        toastContainer.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            max-width: 350px;
        `;
        document.body.appendChild(toastContainer);
    }

    // 创建toast元素
    const toast = document.createElement('div');
    const toastId = 'toast-' + Date.now();
    toast.id = toastId;

    const bgColor = {
        'success': '#28a745',
        'error': '#dc3545',
        'warning': '#ffc107',
        'info': '#17a2b8'
    }[type] || '#17a2b8';

    const icon = {
        'success': 'fas fa-check-circle',
        'error': 'fas fa-exclamation-circle',
        'warning': 'fas fa-exclamation-triangle',
        'info': 'fas fa-info-circle'
    }[type] || 'fas fa-info-circle';

    toast.innerHTML = `
        <div style="
            background: ${bgColor};
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        ">
            <i class="${icon} me-2"></i>
            <span>${message}</span>
            <button onclick="removeToast('${toastId}')" style="
                background: none;
                border: none;
                color: white;
                margin-left: auto;
                padding: 0 0 0 10px;
                cursor: pointer;
                font-size: 18px;
            ">&times;</button>
        </div>
    `;

    toastContainer.appendChild(toast);

    // 显示动画
    setTimeout(() => {
        toast.firstElementChild.style.transform = 'translateX(0)';
    }, 100);

    // 自动隐藏
    setTimeout(() => {
        removeToast(toastId);
    }, 4000);
}

function removeToast(toastId) {
    const toast = document.getElementById(toastId);
    if (toast) {
        toast.firstElementChild.style.transform = 'translateX(100%)';
        setTimeout(() => {
            if (toast.parentNode) {
                toast.parentNode.removeChild(toast);
            }
        }, 300);
    }
}

function updateQuestionCounts() {
    // 模拟从API获取各公司题目数量
    const companies = ['alibaba', 'tencent', 'bytedance', 'baidu', 'meituan', 'jd'];
    companies.forEach(company => {
        // 这里应该调用实际的API
        const count = Math.floor(Math.random() * 20) + 5;
        const element = document.getElementById(`${company}-questions`);
        if (element) {
            element.textContent = count;
        }
    });
}

function setupFilters() {
    const filters = ['companyTypeFilter', 'positionFilter', 'yearFilter'];
    filters.forEach(filterId => {
        document.getElementById(filterId).addEventListener('change', applyFilters);
    });
}

function applyFilters() {
    const companyType = document.getElementById('companyTypeFilter').value;
    const position = document.getElementById('positionFilter').value;
    const year = document.getElementById('yearFilter').value;

    // 显示加载状态
    const companiesList = document.getElementById('companiesList');
    companiesList.style.opacity = '0.5';

    // 模拟筛选过程
    showToast('正在筛选公司...', 'info');

    setTimeout(() => {
        // 这里应该根据筛选条件显示/隐藏公司卡片
        filterCompanyCards(companyType, position, year);
        companiesList.style.opacity = '1';
        showToast('筛选完成', 'success');
    }, 500);
}

function filterCompanyCards(companyType, position, year) {
    const cards = document.querySelectorAll('.company-card').forEach(card => {
        // 简单的显示/隐藏逻辑，实际应用中应该根据真实数据筛选
        card.closest('.col-md-6').style.display = 'block';
    });

    // 添加筛选动画
    document.querySelectorAll('.company-card').forEach((card, index) => {
        card.style.animation = `fadeInUp 0.6s ease ${index * 0.1}s both`;
    });
}

// 添加CSS动画
const style = document.createElement('style');
style.textContent = `
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
`;
document.head.appendChild(style);

function viewCompanyDetail(company) {
    const companyInfo = getCompanyInfo(company);

    // 添加加载动画
    document.getElementById('companyModalTitle').innerHTML = `
        <i class="fas fa-building me-2"></i>${companyInfo.name} 面试详情
    `;

    document.getElementById('companyModalContent').innerHTML = `
        <div class="company-detail">
            <!-- 公司头部信息 -->
            <div class="company-detail-header mb-4 p-4 rounded" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h5 class="mb-2">${companyInfo.name}</h5>
                        <p class="mb-0 opacity-90">${companyInfo.description}</p>
                    </div>
                    <div class="col-md-4 text-end">
                        <div class="company-stats-mini">
                            <div class="d-flex justify-content-end gap-3">
                                <div class="text-center">
                                    <div class="h4 mb-0">${companyInfo.questionTypes.reduce((sum, type) => sum + type.count, 0)}</div>
                                    <small>题目总数</small>
                                </div>
                                <div class="text-center">
                                    <div class="h4 mb-0">${companyInfo.difficulty || '4.2'}</div>
                                    <small>平均难度</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="detail-card p-3 border rounded">
                        <h6 class="text-primary mb-3"><i class="fas fa-star me-2"></i>面试特点</h6>
                        <ul class="list-unstyled">
                            ${companyInfo.features.map(feature =>
                                `<li class="mb-2"><i class="fas fa-check text-success me-2"></i>${feature}</li>`
                            ).join('')}
                        </ul>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="detail-card p-3 border rounded">
                        <h6 class="text-primary mb-3"><i class="fas fa-code me-2"></i>技术重点</h6>
                        <div class="d-flex gap-2 flex-wrap">
                            ${companyInfo.techStack.map(tech =>
                                `<span class="badge bg-gradient-primary px-3 py-2">${tech}</span>`
                            ).join('')}
                        </div>
                    </div>
                </div>
            </div>

            <div class="mb-4">
                <h6 class="text-primary mb-3"><i class="fas fa-chart-pie me-2"></i>题目分布</h6>
                <div class="row">
                    ${companyInfo.questionTypes.map((type, index) => {
                        const colors = ['primary', 'success', 'warning', 'info'];
                        return `
                        <div class="col-md-4 mb-3">
                            <div class="text-center p-3 border rounded">
                                <div class="h3 text-${colors[index % colors.length]} mb-2">${type.count}</div>
                                <div class="text-muted">${type.name}</div>
                                <div class="progress mt-2" style="height: 4px;">
                                    <div class="progress-bar bg-${colors[index % colors.length]}"
                                         style="width: ${(type.count / Math.max(...companyInfo.questionTypes.map(t => t.count))) * 100}%"></div>
                                </div>
                            </div>
                        </div>
                    `;
                    }).join('')}
                </div>
            </div>

            <div class="alert alert-light border-start border-4 border-primary">
                <h6 class="text-primary mb-2"><i class="fas fa-lightbulb me-2"></i>面试建议</h6>
                <p class="mb-0">${companyInfo.advice}</p>
            </div>

            <!-- 快速开始按钮 -->
            <div class="text-center mt-4">
                <button class="btn practice-btn btn-lg px-5" onclick="startCompanyPractice('${company}', this)">
                    <i class="fas fa-rocket me-2"></i>立即开始练习
                </button>
            </div>
        </div>
    `;

    // 更新模态框底部按钮
    document.getElementById('startCompanyPracticeBtn').onclick = () => startCompanyPractice(company);

    // 显示模态框
    new bootstrap.Modal(document.getElementById('companyDetailModal')).show();
}

function getCompanyInfo(company) {
    const companyData = {
        alibaba: {
            name: '阿里巴巴',
            description: '中国最大的电商和云计算公司，注重技术深度和业务理解能力。',
            features: ['重视基础算法', '考察系统设计', '关注业务思维', '多轮技术面试'],
            techStack: ['Vue', 'React', 'Node.js', '微服务', '云计算'],
            questionTypes: [
                { name: '算法题', count: 5 },
                { name: '系统设计', count: 4 },
                { name: '前端基础', count: 3 }
            ],
            advice: '准备好算法基础，了解分布式系统，关注阿里的技术栈和业务场景。'
        },
        tencent: {
            name: '腾讯',
            description: '中国领先的互联网公司，以社交和游戏为核心业务。',
            features: ['注重基础扎实', '考察项目经验', '重视团队协作', '技术与产品并重'],
            techStack: ['React', 'Vue', '微信生态', 'Node.js', '小程序'],
            questionTypes: [
                { name: '前端基础', count: 4 },
                { name: '项目经验', count: 3 },
                { name: '算法思维', count: 1 }
            ],
            advice: '重点准备前端基础知识，熟悉微信生态，准备好项目经验的详细介绍。'
        },
        bytedance: {
            name: '字节跳动',
            description: '全球化的移动互联网公司，以今日头条、抖音等产品闻名。',
            features: ['算法要求高', '代码质量严格', '重视性能优化', '国际化视野'],
            techStack: ['React', 'Vue', 'Go', '算法优化', '大数据'],
            questionTypes: [
                { name: '算法编程', count: 8 },
                { name: '系统优化', count: 4 },
                { name: '技术方案', count: 3 }
            ],
            advice: '重点刷算法题，准备代码实现，关注性能优化和用户体验。'
        },
        baidu: {
            name: '百度',
            description: '中国领先的搜索引擎和AI公司。',
            features: ['AI技术重点', '搜索算法', '基础扎实', '技术深度'],
            techStack: ['前端框架', 'AI技术', '搜索算法', 'Python'],
            questionTypes: [
                { name: '前端技术', count: 3 },
                { name: 'AI相关', count: 2 },
                { name: '算法基础', count: 1 }
            ],
            advice: '注重前端基础，了解AI相关技术，准备搜索和推荐算法知识。'
        },
        meituan: {
            name: '美团',
            description: '中国领先的生活服务电商平台。',
            features: ['业务导向', '实用技术', '用户体验', '数据驱动'],
            techStack: ['React', 'Vue', '数据分析', '业务系统'],
            questionTypes: [
                { name: '业务理解', count: 3 },
                { name: '技术实现', count: 3 },
                { name: '数据处理', count: 1 }
            ],
            advice: '了解O2O业务模式，准备实际项目经验，关注用户体验优化。'
        },
        jd: {
            name: '京东',
            description: '中国领先的电商和零售基础设施服务商。',
            features: ['电商技术', '供应链系统', '技术稳定性', '团队协作'],
            techStack: ['前端技术', '电商系统', '供应链', '微服务'],
            questionTypes: [
                { name: '电商技术', count: 2 },
                { name: '系统稳定性', count: 2 },
                { name: '团队协作', count: 1 }
            ],
            advice: '了解电商业务流程，准备高并发处理方案，重视系统稳定性。'
        },
        netease: {
            name: '网易',
            description: '中国领先的互联网技术公司，以游戏、邮箱、音乐等产品著称。',
            features: ['游戏技术', '前端创新', '用户体验', '技术深度'],
            techStack: ['游戏引擎', '前端框架', 'Node.js', '图形技术'],
            questionTypes: [
                { name: '游戏开发', count: 2 },
                { name: '前端技术', count: 1 },
                { name: '用户体验', count: 1 }
            ],
            advice: '了解游戏开发技术，准备前端框架知识，关注用户体验设计。'
        }
    };

    return companyData[company] || {};
}

function startCompanyPractice(company, buttonElement) {
    // 添加加载状态
    if (buttonElement) {
        buttonElement.classList.add('loading');
        const originalText = buttonElement.innerHTML;
        buttonElement.innerHTML = '<span style="opacity: 0;">加载中...</span>';

        // 显示toast提示
        showToast(`正在进入${getCompanyDisplayName(company)}题库...`, 'info');

        // 模拟加载延迟，增强用户体验
        setTimeout(() => {
            window.location.href = `/interview/practice?company=${company}`;
        }, 800);

        // 如果3秒后还没跳转，恢复按钮状态
        setTimeout(() => {
            if (buttonElement) {
                buttonElement.classList.remove('loading');
                buttonElement.innerHTML = originalText;
            }
        }, 3000);
    } else {
        // 直接跳转（兼容旧调用方式）
        window.location.href = `/interview/practice?company=${company}`;
    }
}

function getCompanyDisplayName(company) {
    const names = {
        'alibaba': '阿里巴巴',
        'tencent': '腾讯',
        'bytedance': '字节跳动',
        'baidu': '百度',
        'meituan': '美团',
        'jd': '京东',
        'netease': '网易',
        'xiaomi': '小米'
    };
    return names[company] || company;
}

// 显示添加公司模态框
function showAddCompanyModal() {
    new bootstrap.Modal(document.getElementById('addCompanyModal')).show();
}

// 添加新公司
function addNewCompany() {
    const form = document.getElementById('addCompanyForm');
    const formData = new FormData(form);

    // 获取表单数据
    const companyData = {
        name: document.getElementById('companyName').value.trim(),
        type: document.getElementById('companyType').value,
        difficulty: parseFloat(document.getElementById('companyDifficulty').value),
        description: document.getElementById('companyDescription').value.trim(),
        techStack: []
    };

    // 获取选中的技术栈
    const techCheckboxes = document.querySelectorAll('input[type="checkbox"]:checked');
    techCheckboxes.forEach(checkbox => {
        companyData.techStack.push(checkbox.value);
    });

    // 验证必填字段
    if (!companyData.name) {
        showToast('请输入公司名称', 'error');
        return;
    }

    // 显示加载状态
    const saveBtn = event.target;
    const originalText = saveBtn.innerHTML;
    saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>保存中...';
    saveBtn.disabled = true;

    // 发送请求到后端
    fetch('/api/companies', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(companyData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showToast('公司添加成功！', 'success');
            // 关闭模态框
            bootstrap.Modal.getInstance(document.getElementById('addCompanyModal')).hide();
            // 重置表单
            form.reset();
            // 添加新的公司卡片到页面
            addCompanyCardToPage(data.company);
            // 通知其他页面刷新公司列表
            notifyCompanyListUpdate();
        } else {
            showToast(data.message || '添加失败', 'error');
        }
    })
    .catch(error => {
        console.error('添加公司失败:', error);
        showToast('网络错误，请重试', 'error');
    })
    .finally(() => {
        // 恢复按钮状态
        saveBtn.innerHTML = originalText;
        saveBtn.disabled = false;
    });
}

// 添加公司卡片到页面
function addCompanyCardToPage(company) {
    const companiesList = document.getElementById('companiesList');
    const companyCard = createCompanyCard(company);
    companiesList.insertAdjacentHTML('beforeend', companyCard);

    // 添加入场动画
    const newCard = companiesList.lastElementChild.querySelector('.company-card');
    if (newCard) {
        newCard.style.opacity = '0';
        newCard.style.transform = 'translateY(50px)';
        setTimeout(() => {
            newCard.style.transition = 'all 0.6s cubic-bezier(0.25, 0.8, 0.25, 1)';
            newCard.style.opacity = '1';
            newCard.style.transform = 'translateY(0)';
        }, 100);
    }
}

// 创建公司卡片HTML
function createCompanyCard(company) {
    const techBadges = company.techStack.map(tech =>
        `<span class="type-badge type-theory">${tech}</span>`
    ).join('');

    const companyClass = `company-${company.id || company.name.toLowerCase().replace(/\s+/g, '')}`;

    return `
        <div class="col-md-6 col-lg-4 mb-4">
            <div class="card company-card h-100">
                <div class="company-header ${companyClass}">
                    <h4>${company.name}</h4>
                </div>
                <div class="card-body">
                    <div class="company-stats">
                        <div class="stat-item">
                            <div class="stat-number">${company.questionCount || 0}</div>
                            <div class="stat-label">题目数</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number text-warning">${company.difficulty || '4.0'}</div>
                            <div class="stat-label">难度</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number text-info">${company.passRate || '70'}%</div>
                            <div class="stat-label">通过率</div>
                        </div>
                    </div>

                    <div class="difficulty-chart mb-3">
                        <div class="difficulty-bar difficulty-easy" style="width: 30%"></div>
                        <div class="difficulty-bar difficulty-medium" style="width: 50%"></div>
                        <div class="difficulty-bar difficulty-hard" style="width: 20%"></div>
                    </div>

                    <div class="question-type-badges">
                        ${techBadges}
                    </div>

                    <p class="text-muted mt-3 small">${company.description || '暂无描述'}</p>

                    <div class="d-flex gap-2 mt-4">
                        <button class="btn detail-btn btn-sm flex-fill" onclick="viewCompanyDetail('${company.id || company.name}')">
                            <i class="fas fa-eye me-1"></i>查看详情
                        </button>
                        <button class="btn practice-btn btn-sm flex-fill text-white" onclick="startCompanyPractice('${company.id || company.name}', this)">
                            <i class="fas fa-play me-1"></i>开始练习
                        </button>
                        <button class="btn btn-outline-danger btn-sm" onclick="deleteCompany(${company.id}, '${company.name}', this)" title="删除公司" ${company.isDefault ? 'disabled' : ''}>
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
}

// 通知其他页面更新公司列表
function notifyCompanyListUpdate() {
    console.log('开始通知其他页面更新公司列表...');

    // 方法1: 使用BroadcastChannel API (现代浏览器)
    if (typeof BroadcastChannel !== 'undefined') {
        try {
            const channel = new BroadcastChannel('companyListUpdate');
            channel.postMessage({
                type: 'COMPANY_LIST_UPDATED',
                timestamp: Date.now()
            });
            console.log('BroadcastChannel消息已发送');
            channel.close();
        } catch (e) {
            console.error('BroadcastChannel发送失败:', e);
        }
    }

    // 方法2: 使用localStorage (兼容性更好)
    try {
        const updateData = {
            type: 'COMPANY_LIST_UPDATED',
            timestamp: Date.now(),
            random: Math.random() // 确保每次都是新值
        };
        localStorage.setItem('companyListUpdated', JSON.stringify(updateData));
        console.log('localStorage更新通知已设置');

        // 立即清除，避免累积
        setTimeout(() => {
            localStorage.removeItem('companyListUpdated');
        }, 1000);
    } catch (e) {
        console.error('localStorage设置失败:', e);
    }

    // 方法3: 使用自定义事件 (同页面内)
    try {
        window.dispatchEvent(new CustomEvent('companyListUpdated', {
            detail: { timestamp: Date.now() }
        }));
        console.log('自定义事件已触发');
    } catch (e) {
        console.error('自定义事件触发失败:', e);
    }

    // 如果当前页面有公司选择器，也更新它
    if (typeof loadCompanies === 'function') {
        loadCompanies();
    }
}

function initCharts() {
    // 难度趋势图
    const difficultyCtx = document.getElementById('difficultyTrendChart').getContext('2d');
    new Chart(difficultyCtx, {
        type: 'line',
        data: {
            labels: ['2022', '2023', '2024'],
            datasets: [{
                label: '平均难度',
                data: [3.5, 3.8, 4.1],
                borderColor: '#28a745',
                backgroundColor: 'rgba(40, 167, 69, 0.1)',
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: '面试难度趋势'
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    max: 5
                }
            }
        }
    });
    
    // 主题分布图
    const topicCtx = document.getElementById('topicDistributionChart').getContext('2d');
    new Chart(topicCtx, {
        type: 'doughnut',
        data: {
            labels: ['前端基础', '算法编程', '系统设计', '项目经验', '其他'],
            datasets: [{
                data: [35, 25, 20, 15, 5],
                backgroundColor: [
                    '#28a745',
                    '#dc3545',
                    '#ffc107',
                    '#17a2b8',
                    '#6c757d'
                ]
            }]
        },
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: '题目类型分布'
                }
            }
        }
    });
}

// 删除公司
function deleteCompany(companyId, companyName, buttonElement) {
    // 确认删除
    if (!confirm(`确定要删除公司 "${companyName}" 吗？\n\n删除后将无法恢复，请谨慎操作。`)) {
        return;
    }

    console.log(`开始删除公司: ${companyName} (ID: ${companyId})`);

    // 显示加载状态
    const originalText = buttonElement.innerHTML;
    buttonElement.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
    buttonElement.disabled = true;

    // 发送删除请求
    fetch(`/api/companies/${companyId}`, {
        method: 'DELETE',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showToast(`公司 "${companyName}" 删除成功！`, 'success');

            // 移除公司卡片
            const companyCard = buttonElement.closest('.col-md-6, .col-lg-4');
            if (companyCard) {
                // 添加删除动画
                companyCard.style.transition = 'all 0.5s ease-out';
                companyCard.style.opacity = '0';
                companyCard.style.transform = 'scale(0.8) translateY(-50px)';

                setTimeout(() => {
                    companyCard.remove();
                }, 500);
            }

            // 通知其他页面更新公司列表
            notifyCompanyListUpdate();
        } else {
            showToast(data.message || '删除失败', 'error');
            // 恢复按钮状态
            buttonElement.innerHTML = originalText;
            buttonElement.disabled = false;
        }
    })
    .catch(error => {
        console.error('删除公司失败:', error);
        showToast('网络错误，请重试', 'error');
        // 恢复按钮状态
        buttonElement.innerHTML = originalText;
        buttonElement.disabled = false;
    });
}
</script>
{% endblock %}
